Commands Explained1. /startWhat it does: Yeh command bot ke saath user ka pehla interaction hai. Bot ek welcome message bhejta hai aur user ko /menu command try karne ko bolta hai.Who can use it: Sabhi users (registered ya unregistered).How to use: Bas /start likho aur send karo.What happens: Bot ek simple welcome message bhejta hai. Yeh user ko bot ke features explore karne ke liye guide karta hai.Example:Command: /startOutput: 👋 Welcome to KaamDhenu Bot! Use /menu to get started.2. /registerWhat it does: User ko register karta hai bot ke system mein. User ka name, primary phone number, district, aur optional secondary phone number save hota hai users table mein.Who can use it: Koi bhi user jo register nahi hai ya apna data update karna chahta hai.How to use: /register <name> <primary_phone> <district> [secondary_phone]<name>: Tumhara naam.<primary_phone>: 10-digit phone number (main).<district>: Tumhara district (e.g., SouthDelhi).[secondary_phone]: Optional 10-digit dusra number.What happens:Bot check karta hai ki phone numbers 10 digits ke hain.Data users table mein save hota hai.Success message bhejta hai.Agar phone number invalid hai ya arguments kam hain, error message bhejta hai.Example:Command: /register Harshit 9876543210 SouthDelhi 8765432109Output: ✅ Registered successfully as Harshit from SouthDelhi!Invalid case: /register Harshit 12345 SouthDelhiOutput: ❌ Phone numbers must be 10-digit numbers.3. /my_infoWhat it does: Yeh command user ka detailed address save karta hai ya dikhata hai. Address mein name, house name, landmark, ward number, panchayat, block, sub-district, district, state, aur phones shamil hain. Yeh order placement ke liye use nahi hota, standalone hai.Who can use it: Registered users.How to use:To view: /my_infoTo save: /my_info <name> <house_name> <landmark> <ward_no> <panchayat> <block> <sub_district> <district> <state> <primary_phone> [secondary_phone]What happens:View: Agar koi arguments nahi hain, toh user_info table se saved address dikhata hai.Save: New address details save karta hai. Phone numbers 10-digit hone chahiye.Error handling: Invalid phone ya missing fields ke liye error message.Example:Save: /my_info Harshit SharmaVilla NearTemple Ward5 Gopalpur Sadar Hazaribagh SouthDelhi Delhi 9876543210 8765432109Output: ✅ Address info saved successfully for Harshit! Use /my_info to view.View: /my_infoOutput:📍 *Your Address Info:*
👤 Name: Harshit
🏠 House Name: SharmaVilla
📍 Landmark: NearTemple
🗳 Ward No: Ward5
🌍 Panchayat: Gopalpur
🏢 Block: Sadar
🌆 Sub-District: Hazaribagh
🌇 District: SouthDelhi
🇮🇳 State: Delhi
📞 Primary Phone: 9876543210
📱 Secondary Phone: 8765432109
⏰ Updated At: 2025-06-28 21:34:00Error: /my_info Harshit SharmaVilla NearTemple (incomplete args)Output: ⚠️ Usage: /my_info <name> <house_name> <landmark> <ward_no> <panchayat> <block> <sub_district> <district> <state> <primary_phone> [secondary_phone]4. /profileWhat it does: User ke registered details dikhata hai, jaise name, phones, district, roles, aur registration time.Who can use it: Registered users.How to use: /profileWhat happens:users aur roles table se data fetch karta hai.Roles (admin, worker, district_head, etc.) ko list karta hai, with district if applicable.Markdown format mein details dikhata hai.Example:Command: /profileOutput:👤 *Your Profile:*
Name: Harshit
Primary Phone: 9876543210
Secondary Phone: 8765432109
District: SouthDelhi
Role: worker, district_head (SouthDelhi)
Registered At: 2025-06-28 21:34:00Error: If not registeredOutput: ❌ You are not registered. Use /register to sign up.5. /assign_roleWhat it does: Ek user ko role assign karta hai (admin, worker, district_head, supplier, client). Sirf admin use kar sakta hai.Who can use it: Admin (Telegram ID: 6338398272).How to use: /assign_role <telegram_id> <role> [district]<telegram_id>: User ka Telegram ID.<role>: admin, worker, client, supplier, district_head.[district]: District_head ke liye mandatory.What happens:Validates role aur district (if needed).Role roles table mein save hota hai.User aur admin ko notification bhejta hai.Example:Command: /assign_role 5385320149 district_head SouthDelhiOutput: ✅ Assigned district_head role to 5385320149 for SouthDelhi!User gets: 🔔 You have been assigned the role of district_head for SouthDelhi!Error: /assign_role 5385320149 district_head (missing district)Output: ❌ District is required for district_head role.6. /menuWhat it does: Ek inline keyboard dikhata hai jisme buttons hain: "Show Products", "View Orders", aur "SMS Format".Who can use it: Sabhi users.How to use: /menuWhat happens:Inline keyboard bhejta hai jisse user easily products dekh sakta hai, orders check kar sakta hai, ya SMS format dekh sakta hai.Buttons click karne pe respective actions trigger hote hain.Example:Command: /menuOutput: A message with buttons:📋 *Main Menu*
[🛒 Show Products] [📦 View Orders] [📖 SMS Format]7. /sms_formatWhat it does: Payment SMS ka correct format dikhata hai, user ke registered primary aur secondary phone numbers ke saath.Who can use it: Registered users.How to use: /sms_formatWhat happens:User ke phone numbers users table se fetch karta hai.Ek example SMS format dikhata hai.Example:Command: /sms_formatOutput:📩 *Payment SMS Format*
Send a message like: "Rs.100 Credited to A/c ... by 9876543210"
- Amount must match order total (e.g., 100 INR).
- Use your registered primary (9876543210) or secondary (8765432109) phone.
Example: "Rs.100 Credited to A/c ... by 9876543210"Error: If not registeredOutput: ❌ Please register with /register8. /show_productsWhat it does: Available products ki list dikhata hai, optionally category ke basis pe filter karke. District heads sirf apne district ke products dekh sakte hain.Who can use it: Sabhi users.How to use:All products: /show_productsBy category: /show_products <category>What happens:products table se data fetch karta hai.District heads ke liye district filter apply hota hai.Markdown mein products ki details dikhata hai (name, quantity, district, price, category, added_by, unique_number).Example:Command: /show_products BakeryOutput:🛒 *Available Products:*
📌 *Name:* Cake
📖 *Quantity:* 1000
📍 District: SouthDelhi
💰 *Price:* 100 INR
📋 Category: Bakery
👤 Added By: 6338398272 (Unique Number: 1)Error: If no productsOutput: 📭 No products available.9. /view_ordersWhat it does: User ke saare orders dikhata hai, with order ID, items, total amount, payment status, aur order status.Who can use it: Registered users.How to use: /view_ordersWhat happens:orders table se user ke orders fetch karta hai.Markdown mein details dikhata hai.Example:Command: /view_ordersOutput:📖 *Your Orders:*
📖 *Order ID:* 1
100 x Cake (SouthDelhi) [Added By: 6338398272, Unique Number: 1]
💰 *Total:* 10000 INR
✅ *Payment Status:* Pending
📖 *Order Status:*Error: If no ordersOutput: 📭 You have no orders yet.10. /update_deliveryWhat it does: Ek order ke delivery status ko update karta hai. Admin ya supplier (jisne product add kiya) use kar sakta hai.Who can use it: Admin or supplier (based on product’s added_by).How to use: /update_delivery <order_id> <message>What happens:Order ID validate karta hai.User aur admin ko update message bhejta hai.Example:Command: /update_delivery 1 ShippedOutput: ✅ Delivery update sent for Order ID 1User gets: 🔔 Delivery Update for Order ID 1! Order: 100 x Cake (SouthDelhi) ... Update: ShippedError: If order not foundOutput: ❌ Order ID 1 not found.11. /your_order_is_packedWhat it does: Order ko packed mark karta hai aur user ko notify karta hai. Admin ya supplier use kar sakta hai.Who can use it: Admin or supplier (based on product’s added_by).How to use: /your_order_is_packed <order_id>What happens:Order ID validate karta hai.User ko packed notification bhejta hai.Example:Command: /your_order_is_packed 1Output: ✅ Order packed for Order ID 1User gets: 🚚 Order ID 1 is packed! Order: 100 x Cake (SouthDelhi) ...Error: If unauthorizedOutput: ❌ You are not authorized to perform this action.12. /set_low_stock_thresholdWhat it does: Low stock alert ka threshold set karta hai (admin-only).Who can use it: Admin (6338398272).How to use: /set_low_stock_threshold <quantity>What happens:Threshold settings table mein save hota hai.Admin ko confirmation bhejta hai.Example:Command: /set_low_stock_threshold 50Output: ✅ Low stock threshold set to 50 units.Error: If invalid numberOutput: ❌ Threshold must be a positive number.13. /add_productWhat it does: Naya product add karta hai (worker-only). Unique number automatically assign hota hai (>=1) agar same name ka product district mein hai.Who can use it: Worker, admin, or district_head.How to use: /add_product <name> <qty> <district> <price> <category>What happens:Validates quantity (positive) aur price (non-negative).Unique number assign karta hai.Product products table mein save hota hai.Stock history update hota hai.Low stock check karta hai.Example:Command: /add_product Cake 1000 SouthDelhi 100 BakeryOutput: ✅ Product Cake added with quantity 1000 in SouthDelhi at price 100 INR (Category: Bakery) (Unique Number: 1)Error: If invalid argsOutput: ⚠️ Usage: /add_product <name> <qty> <district> <price> <category>14. /update_productWhat it does: Existing product ke quantity, price, ya category update karta hai. Worker sirf apne add kiye products update kar sakta hai.Who can use it: Worker, admin, or district_head (must match added_by).How to use: /update_product <name> <qty> <district> <price> <unique_number> <category> <added_by>What happens:Validates inputs aur added_by.Product update hota hai products table mein.Stock history mein change log hota hai.Low stock check karta hai.Example:Command: /update_product Cake 500 SouthDelhi 120 1 Bakery 6338398272Output: ✅ Product Cake updated successfully!Error: If unauthorizedOutput: ❌ You can only update products you added.15. /delete_productWhat it does: Product delete karta hai. Worker sirf apne add kiye products delete kar sakta hai.Who can use it: Worker, admin, or district_head (must match added_by).How to use: /delete_product <name> <district> <unique_number> <added_by>What happens:Validates inputs aur added_by.Product products table se delete hota hai.Example:Command: /delete_product Cake SouthDelhi 1 6338398272Output: ✅ Product Cake deleted from SouthDelhiError: If product not foundOutput: ❌ Product Cake not found with the given details.16. /list_unmatchedWhat it does: Failed payment transactions ki list dikhata hai (admin-only).Who can use it: Admin (6338398272).How to use: /list_unmatchedWhat happens:raw_transactions table se failed transactions fetch karta hai (max 10).Details like SMS text, amount, phone, aur note dikhata hai.Example:Command: /list_unmatchedOutput:📜 *Unmatched Transactions:*
ID: 1
SMS: Rs.100 Credited to A/c ... by 9876543210
Amount: 100
Phone: 9876543210
Forwarder Phone: None
Note: No matching order
Time: 2025-06-28 21:34:00
---Error: If no unmatched transactionsOutput: ✅ No unmatched transactions found.Features ExplainedOrder Placement:What it does: Users order place karte hain by sending a text message starting with "Name:" aur "Address:", followed by product lines like "   <added_by> <unique_number>".How it works:Validates product availability, stock, aur unique_number.Stock deduct karta hai products table se.Order orders table mein save hota hai.Admin, district heads, aur suppliers (via itemContacts) ko notify karta hai.Payment reminders bhejta hai at 2, 4, aur 6 minutes. Agar 6 minutes tak payment nahi aata, order cancel hota hai aur stock restore hota hai.Example:Input:Name: Harshit
Address: Main Road
Cake 100 SouthDelhi 6338398272Output:✅ Order placed!
👤 Name: Harshit
🏠 Address: Main Road
🛒 Order:
100 x Cake (SouthDelhi) [Added By: 6338398272, Unique Number: 1]
💰 Total: 10000 INR
📢 Payment SMS will confirm your order within 6 minutes.Payment Processing:What it does: Payment SMS (e.g., "Rs.100 Credited ... by ") ko process karta hai. Matches with pending ya recently cancelled orders.How it works:SMS sirf allowed chat IDs (6338398272, -1002410173827) mein process hota hai.Amount aur phone number se order match karta hai.Stock update karta hai (if order was cancelled).Order status "Confirmed" hota hai.User, admin, district heads, aur suppliers ko notify karta hai.Unmatched transactions save hota hai raw_transactions aur transactions tables mein.Example:SMS: Rs.100 Credited to A/c ... by 9876543210Output:✅ Order ID 1 confirmed!
💰 100 INR
🛒 100 x Cake (SouthDelhi) [Added By: 6338398272, Unique Number: 1]Low Stock Alerts:What it does: Jab product ka stock low threshold (default 100) se niche jata hai, admin, district heads, aur worker ko alert bhejta hai.How it works: Trigger hota hai on product add, update, order placement, ya cancellation.Example:Alert: ⚠️ Low Stock Alert! Product: Cake, District: SouthDelhi, Quantity: 50, Unique Number: 1Role-Based Access:What it does: Alag-alag roles ke liye access control:Admin: All commands.Worker: Add, update, delete products.District Head: District-specific products in /show_products.Supplier: Delivery updates for their products.Client: Register, order, view info.Case-Insensitive Product Matching:What it does: Product names case-insensitive hain (e.g., "Cake" aur "cake" same hain) for /add_product, /update_product, /delete_product, aur orders.Unique Number Validation:What it does: Same product name ke liye district mein unique number (>=1) assign karta hai. Ensures no duplicate product IDs.Standalone /my_info:What it does: /my_info order placement ke liye use nahi hota. Sirf address save/view ke liye hai. Orders /register ke data (name, phone, district) use karte hain.Logging:What it does: Har action, error, aur event ko bot.log file aur console mein log karta hai with IST timestamps.Example: 2025-06-28 21:34:00 IST info: Product Cake added by 6338398272 with unique_number 1Error Handling:What it does: Database errors, invalid inputs, aur Telegram API issues ko handle karta hai. User ko clear error messages bhejta hai, aur errors log karta hai.Inline Keyboard:What it does: /menu command inline buttons provide karta hai for easy navigation.Item Contacts:What it does: Products ko suppliers ke Telegram IDs se map karta hai (e.g., potato SouthDelhi: 6338398272) for order notifications.Example: Order placed for "Cake SouthDelhi" notifies user 6338398272.Payment Reminders and Cancellation:What it does: Pending orders ke liye 2 aur 4 minutes pe reminders bhejta hai. 6 minutes tak payment na aaye toh order cancel hota hai, stock restore hota hai, aur user/admin ko notify hota hai.Example:Reminder: 🦒 Reminder: Payment pending for Order ID 1! ...Cancellation: ❌ Order ID 1 has been cancelled due to no payment confirmation. Stock restored